<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Utilidades | ESP32 Bibliotecas</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="Documenta rápido">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/ESP32Bibliotecas/assets/css/0.styles.df5a2db4.css" as="style"><link rel="preload" href="/ESP32Bibliotecas/assets/js/app.677a62d4.js" as="script"><link rel="preload" href="/ESP32Bibliotecas/assets/js/2.01b20be0.js" as="script"><link rel="preload" href="/ESP32Bibliotecas/assets/js/15.b360789d.js" as="script"><link rel="prefetch" href="/ESP32Bibliotecas/assets/js/10.10ac5744.js"><link rel="prefetch" href="/ESP32Bibliotecas/assets/js/11.0c8525d9.js"><link rel="prefetch" href="/ESP32Bibliotecas/assets/js/12.e3522ef7.js"><link rel="prefetch" href="/ESP32Bibliotecas/assets/js/13.5645fa86.js"><link rel="prefetch" href="/ESP32Bibliotecas/assets/js/14.971a1076.js"><link rel="prefetch" href="/ESP32Bibliotecas/assets/js/16.15e3e290.js"><link rel="prefetch" href="/ESP32Bibliotecas/assets/js/3.0717bf0c.js"><link rel="prefetch" href="/ESP32Bibliotecas/assets/js/4.1a8f7237.js"><link rel="prefetch" href="/ESP32Bibliotecas/assets/js/5.bb6a4b3f.js"><link rel="prefetch" href="/ESP32Bibliotecas/assets/js/6.034b101a.js"><link rel="prefetch" href="/ESP32Bibliotecas/assets/js/7.2f30368f.js"><link rel="prefetch" href="/ESP32Bibliotecas/assets/js/8.3c8f93b5.js"><link rel="prefetch" href="/ESP32Bibliotecas/assets/js/9.56df714c.js">
    <link rel="stylesheet" href="/ESP32Bibliotecas/assets/css/0.styles.df5a2db4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ESP32Bibliotecas/" class="home-link router-link-active"><!----> <span class="site-name">ESP32 Bibliotecas</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/ESP32Bibliotecas/wifi/" class="nav-link">
  WiFi
</a></div><div class="nav-item"><a href="/ESP32Bibliotecas/utilidades/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Utilidades
</a></div><div class="nav-item"><a href="/ESP32Bibliotecas/sensores/" class="nav-link">
  Sensores
</a></div><div class="nav-item"><a href="/ESP32Bibliotecas/actuadores/" class="nav-link">
  Actuadores
</a></div><div class="nav-item"><a href="/ESP32Bibliotecas/motores/" class="nav-link">
  Motores
</a></div><div class="nav-item"><a href="/ESP32Bibliotecas/pantallas/" class="nav-link">
  Pantallas
</a></div><div class="nav-item"><a href="https://youtu.be/FAtC9YKy1Rk" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Canal Youtube
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/ESP32Bibliotecas/wifi/" class="nav-link">
  WiFi
</a></div><div class="nav-item"><a href="/ESP32Bibliotecas/utilidades/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Utilidades
</a></div><div class="nav-item"><a href="/ESP32Bibliotecas/sensores/" class="nav-link">
  Sensores
</a></div><div class="nav-item"><a href="/ESP32Bibliotecas/actuadores/" class="nav-link">
  Actuadores
</a></div><div class="nav-item"><a href="/ESP32Bibliotecas/motores/" class="nav-link">
  Motores
</a></div><div class="nav-item"><a href="/ESP32Bibliotecas/pantallas/" class="nav-link">
  Pantallas
</a></div><div class="nav-item"><a href="https://youtu.be/FAtC9YKy1Rk" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Canal Youtube
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Utilidades</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ESP32Bibliotecas/utilidades/#esp32-pwm" class="sidebar-link">ESP32 PWM</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/ESP32Bibliotecas/utilidades/#fecha-y-hora-ntp-server" class="sidebar-link">Fecha y hora NTP Server</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/ESP32Bibliotecas/utilidades/#sueno-profundo-deep-sleep" class="sidebar-link">Sueño profundo Deep Sleep</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="utilidades"><a href="#utilidades" class="header-anchor">#</a> Utilidades</h1> <h2 id="esp32-pwm"><a href="#esp32-pwm" class="header-anchor">#</a> ESP32 PWM</h2> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// the number of the LED pin</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> ledPin <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>  <span class="token comment">// 16 corresponds to GPIO16</span>

<span class="token comment">// setting PWM properties</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> freq <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> ledChannel <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> resolution <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
 
<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// configure LED PWM functionalitites</span>
  <span class="token function">ledcSetup</span><span class="token punctuation">(</span>ledChannel<span class="token punctuation">,</span> freq<span class="token punctuation">,</span> resolution<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// attach the channel to the GPIO to be controlled</span>
  <span class="token function">ledcAttachPin</span><span class="token punctuation">(</span>ledPin<span class="token punctuation">,</span> ledChannel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// increase the LED brightness</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> dutyCycle <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> dutyCycle <span class="token operator">&lt;=</span> <span class="token number">255</span><span class="token punctuation">;</span> dutyCycle<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   
    <span class="token comment">// changing the LED brightness with PWM</span>
    <span class="token function">ledcWrite</span><span class="token punctuation">(</span>ledChannel<span class="token punctuation">,</span> dutyCycle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// decrease the LED brightness</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> dutyCycle <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span> dutyCycle <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> dutyCycle<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// changing the LED brightness with PWM</span>
    <span class="token function">ledcWrite</span><span class="token punctuation">(</span>ledChannel<span class="token punctuation">,</span> dutyCycle<span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="fecha-y-hora-ntp-server"><a href="#fecha-y-hora-ntp-server" class="header-anchor">#</a> Fecha y hora NTP Server</h2> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;WiFi.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;time.h&quot;</span></span>

<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> ssid     <span class="token operator">=</span> <span class="token string">&quot;REPLACE_WITH_YOUR_SSID&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> password <span class="token operator">=</span> <span class="token string">&quot;REPLACE_WITH_YOUR_PASSWORD&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> ntpServer <span class="token operator">=</span> <span class="token string">&quot;pool.ntp.org&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">long</span>  gmtOffset_sec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">int</span>   daylightOffset_sec <span class="token operator">=</span> <span class="token number">3600</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Connect to Wi-Fi</span>
  Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Connecting to &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ssid<span class="token punctuation">)</span><span class="token punctuation">;</span>
  WiFi<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>WiFi<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> WL_CONNECTED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;WiFi connected.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Init and get the time</span>
  <span class="token function">configTime</span><span class="token punctuation">(</span>gmtOffset_sec<span class="token punctuation">,</span> daylightOffset_sec<span class="token punctuation">,</span> ntpServer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printLocalTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//disconnect WiFi as it's no longer needed</span>
  WiFi<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  WiFi<span class="token punctuation">.</span><span class="token function">mode</span><span class="token punctuation">(</span>WIFI_OFF<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printLocalTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">printLocalTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">tm</span> timeinfo<span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">getLocalTime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timeinfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to obtain time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timeinfo<span class="token punctuation">,</span> <span class="token string">&quot;%A, %B %d %Y %H:%M:%S&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Day of week: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timeinfo<span class="token punctuation">,</span> <span class="token string">&quot;%A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Month: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timeinfo<span class="token punctuation">,</span> <span class="token string">&quot;%B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Day of Month: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timeinfo<span class="token punctuation">,</span> <span class="token string">&quot;%d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Year: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timeinfo<span class="token punctuation">,</span> <span class="token string">&quot;%Y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Hour: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timeinfo<span class="token punctuation">,</span> <span class="token string">&quot;%H&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Hour (12 hour format): &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timeinfo<span class="token punctuation">,</span> <span class="token string">&quot;%I&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Minute: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timeinfo<span class="token punctuation">,</span> <span class="token string">&quot;%M&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Second: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timeinfo<span class="token punctuation">,</span> <span class="token string">&quot;%S&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Time variables&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> timeHour<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">strftime</span><span class="token punctuation">(</span>timeHour<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;%H&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>timeinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>timeHour<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> timeWeekDay<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">strftime</span><span class="token punctuation">(</span>timeWeekDay<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">&quot;%A&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>timeinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>timeWeekDay<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="sueno-profundo-deep-sleep"><a href="#sueno-profundo-deep-sleep" class="header-anchor">#</a> Sueño profundo Deep Sleep</h2> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">/*
Simple Deep Sleep with Timer Wake Up
=====================================
ESP32 offers a deep sleep mode for effective power
saving as power is an important factor for IoT
applications. In this mode CPUs, most of the RAM,
and all the digital peripherals which are clocked
from APB_CLK are powered off. The only parts of
the chip which can still be powered on are:
RTC controller, RTC peripherals ,and RTC memories

This code displays the most basic deep sleep with
a timer to wake it up and how to store data in
RTC memory to use it over reboots

This code is under Public Domain License.

Author:
Pranav Cherukupalli &lt;cherukupallip@gmail.com&gt;
*/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">uS_TO_S_FACTOR</span> <span class="token expression"><span class="token number">1000000</span>  </span><span class="token comment">/* Conversion factor for micro seconds to seconds */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TIME_TO_SLEEP</span>  <span class="token expression"><span class="token number">5</span>        </span><span class="token comment">/* Time ESP32 will go to sleep (in seconds) */</span></span>

RTC_DATA_ATTR <span class="token keyword">int</span> bootCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">/*
Method to print the reason by which ESP32
has been awaken from sleep
*/</span>
<span class="token keyword">void</span> <span class="token function">print_wakeup_reason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  esp_sleep_wakeup_cause_t wakeup_reason<span class="token punctuation">;</span>

  wakeup_reason <span class="token operator">=</span> <span class="token function">esp_sleep_get_wakeup_cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">switch</span><span class="token punctuation">(</span>wakeup_reason<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">case</span> ESP_SLEEP_WAKEUP_EXT0 <span class="token operator">:</span> Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Wakeup caused by external signal using RTC_IO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> ESP_SLEEP_WAKEUP_EXT1 <span class="token operator">:</span> Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Wakeup caused by external signal using RTC_CNTL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> ESP_SLEEP_WAKEUP_TIMER <span class="token operator">:</span> Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Wakeup caused by timer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> ESP_SLEEP_WAKEUP_TOUCHPAD <span class="token operator">:</span> Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Wakeup caused by touchpad&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> ESP_SLEEP_WAKEUP_ULP <span class="token operator">:</span> Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Wakeup caused by ULP program&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span> <span class="token operator">:</span> Serial<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Wakeup was not caused by deep sleep: %d\n&quot;</span><span class="token punctuation">,</span>wakeup_reason<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Take some time to open up the Serial Monitor</span>

  <span class="token comment">//Increment boot number and print it every reboot</span>
  <span class="token operator">++</span>bootCount<span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Boot number: &quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>bootCount<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//Print the wakeup reason for ESP32</span>
  <span class="token function">print_wakeup_reason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/*
  First we configure the wake up source
  We set our ESP32 to wake up every 5 seconds
  */</span>
  <span class="token function">esp_sleep_enable_timer_wakeup</span><span class="token punctuation">(</span>TIME_TO_SLEEP <span class="token operator">*</span> uS_TO_S_FACTOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Setup ESP32 to sleep for every &quot;</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>TIME_TO_SLEEP<span class="token punctuation">)</span> <span class="token operator">+</span>
  <span class="token string">&quot; Seconds&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/*
  Next we decide what all peripherals to shut down/keep on
  By default, ESP32 will automatically power down the peripherals
  not needed by the wakeup source, but if you want to be a poweruser
  this is for you. Read in detail at the API docs
  http://esp-idf.readthedocs.io/en/latest/api-reference/system/deep_sleep.html
  Left the line commented as an example of how to configure peripherals.
  The line below turns off all RTC peripherals in deep sleep.
  */</span>
  <span class="token comment">//esp_deep_sleep_pd_config(ESP_PD_DOMAIN_RTC_PERIPH, ESP_PD_OPTION_OFF);</span>
  <span class="token comment">//Serial.println(&quot;Configured all RTC Peripherals to be powered down in sleep&quot;);</span>

  <span class="token comment">/*
  Now that we have setup a wake cause and if needed setup the
  peripherals state in deep sleep, we can now start going to
  deep sleep.
  In the case that no wake up sources were provided but deep
  sleep was started, it will sleep forever unless hardware
  reset occurs.
  */</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Going to sleep now&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token function">esp_deep_sleep_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;This will never be printed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//This is not going to be called</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/ESP32Bibliotecas/assets/js/app.677a62d4.js" defer></script><script src="/ESP32Bibliotecas/assets/js/2.01b20be0.js" defer></script><script src="/ESP32Bibliotecas/assets/js/15.b360789d.js" defer></script>
  </body>
</html>
